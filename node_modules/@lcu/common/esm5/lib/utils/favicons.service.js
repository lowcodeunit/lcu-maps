import { __values } from "tslib";
import { Inject } from '@angular/core';
import { InjectionToken } from '@angular/core';
export var BROWSER_FAVICONS_CONFIG = new InjectionToken('Favicons Configuration');
/**
 * Abstract class that acts as both interface for implementation and as the dependency-injection
 */
var FaviconsService = /** @class */ (function () {
    function FaviconsService() {
    }
    return FaviconsService;
}());
export { FaviconsService };
/**
 * Provide the browser-oriented implementation of the Favicons class
 */
var BrowserFavicons = /** @class */ (function () {
    /**
     * initialize the Favicons service.
     */
    function BrowserFavicons(config) {
        this.elementId = 'favicons-service-injected-node';
        this.icons = Object.assign(Object.create(null), config.icons);
        this.useCacheBusting = (config.cacheBusting || false);
        // Since the document may have a static favicon definition, we want to strip out
        // any exisitng elements that are attempting to define a favicon. This way, there
        // is only one favicon element on the page at a time.
        this.removeExternalLinkElements();
    }
    /**
     * Active favicon with given identifier
     *
     * @param name favicon name
     */
    BrowserFavicons.prototype.activate = function (name) {
        if (!this.icons[name]) {
            throw (new Error("Favicon for [ " + name + " ] not found."));
        }
        this.setNode(this.icons[name].type, this.icons[name].href);
    };
    /**
     * Activate the default favicon (with isDefault set to True)
     */
    BrowserFavicons.prototype.reset = function () {
        var e_1, _a;
        try {
            for (var _b = __values(Object.keys(this.icons)), _c = _b.next(); !_c.done; _c = _b.next()) {
                var name_1 = _c.value;
                var icon = this.icons[name_1];
                if (icon.isDefault) {
                    this.setNode(icon.type, icon.href);
                    return;
                }
            }
        }
        catch (e_1_1) { e_1 = { error: e_1_1 }; }
        finally {
            try {
                if (_c && !_c.done && (_a = _b.return)) _a.call(_b);
            }
            finally { if (e_1) throw e_1.error; }
        }
        // If we made it this far, none of the favicons were flagged as default. In that
        // case, let's just remove the favicon node altogether.
        this.removeNode();
    };
    /**
     * Inject the favicon element into the document header
     *
     * @param type type of icon (.png, .jpeg, etc)
     *
     * @param href location
     */
    BrowserFavicons.prototype.addNode = function (type, href) {
        var linkElement = document.createElement('link');
        linkElement.setAttribute('id', this.elementId);
        linkElement.setAttribute('rel', 'icon');
        linkElement.setAttribute('type', type);
        linkElement.setAttribute('href', href);
        document.head.appendChild(linkElement);
    };
    /**
     * Return an augmented HREF value with a cache-busting query-string parameter
     *
     * @param href location
     */
    BrowserFavicons.prototype.cacheBustHref = function (href) {
        var augmentedHref = (href.indexOf('?') === -1)
            ? href + "?faviconCacheBust=" + Date.now()
            : href + "&faviconCacheBust=" + Date.now();
        return (augmentedHref);
    };
    /**
     * I remove any favicon nodes that are not controlled by this service
     */
    BrowserFavicons.prototype.removeExternalLinkElements = function () {
        var e_2, _a;
        // tslint:disable-next-line:prefer-const
        var linkElements = document.querySelectorAll("link[ rel ~= 'icon' i]");
        try {
            for (var _b = __values(Array.from(linkElements)), _c = _b.next(); !_c.done; _c = _b.next()) {
                var linkElement = _c.value;
                linkElement.parentNode.removeChild(linkElement);
            }
        }
        catch (e_2_1) { e_2 = { error: e_2_1 }; }
        finally {
            try {
                if (_c && !_c.done && (_a = _b.return)) _a.call(_b);
            }
            finally { if (e_2) throw e_2.error; }
        }
    };
    /**
     * Remove the favicon node from the document header
     */
    BrowserFavicons.prototype.removeNode = function () {
        var linkElement = document.head.querySelector('#' + this.elementId);
        if (linkElement) {
            document.head.removeChild(linkElement);
        }
    };
    /**
     * Remove existing favicon node and inject a new favicon node with the give
     * elemet settings
     *
     * @param type type of favicon
     * @param href location
     */
    BrowserFavicons.prototype.setNode = function (type, href) {
        var augmentedHref = this.useCacheBusting
            ? this.cacheBustHref(href)
            : href;
        this.removeNode();
        this.addNode(type, augmentedHref);
    };
    BrowserFavicons.ctorParameters = function () { return [
        { type: undefined, decorators: [{ type: Inject, args: [BROWSER_FAVICONS_CONFIG,] }] }
    ]; };
    return BrowserFavicons;
}());
export { BrowserFavicons };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmF2aWNvbnMuc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BsY3UvY29tbW9uLyIsInNvdXJjZXMiOlsibGliL3V0aWxzL2Zhdmljb25zLnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLE9BQU8sRUFBRSxNQUFNLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDdkMsT0FBTyxFQUFFLGNBQWMsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQWlCL0MsTUFBTSxDQUFDLElBQUksdUJBQXVCLEdBQUcsSUFBSSxjQUFjLENBQWtCLHdCQUF3QixDQUFFLENBQUM7QUFFcEc7O0dBRUc7QUFDSDtJQUFBO0lBR0EsQ0FBQztJQUFELHNCQUFDO0FBQUQsQ0FBQyxBQUhELElBR0M7O0FBRUQ7O0dBRUc7QUFDSDtJQU1JOztPQUVHO0lBQ0gseUJBQWdELE1BQXNCO1FBRWxFLElBQUksQ0FBQyxTQUFTLEdBQUcsZ0NBQWdDLENBQUM7UUFDbEQsSUFBSSxDQUFDLEtBQUssR0FBRyxNQUFNLENBQUMsTUFBTSxDQUFFLE1BQU0sQ0FBQyxNQUFNLENBQUUsSUFBSSxDQUFFLEVBQUUsTUFBTSxDQUFDLEtBQUssQ0FBRSxDQUFDO1FBQ2xFLElBQUksQ0FBQyxlQUFlLEdBQUcsQ0FBRSxNQUFNLENBQUMsWUFBWSxJQUFJLEtBQUssQ0FBRSxDQUFDO1FBRXhELGdGQUFnRjtRQUNoRixpRkFBaUY7UUFDakYscURBQXFEO1FBQ3JELElBQUksQ0FBQywwQkFBMEIsRUFBRSxDQUFDO0lBRXRDLENBQUM7SUFFRDs7OztPQUlHO0lBQ0ksa0NBQVEsR0FBZixVQUFpQixJQUFZO1FBRXpCLElBQUssQ0FBRSxJQUFJLENBQUMsS0FBSyxDQUFFLElBQUksQ0FBRSxFQUFHO1lBRXhCLE1BQUssQ0FBRSxJQUFJLEtBQUssQ0FBRSxtQkFBa0IsSUFBSSxrQkFBZ0IsQ0FBRSxDQUFFLENBQUM7U0FFaEU7UUFFRCxJQUFJLENBQUMsT0FBTyxDQUFFLElBQUksQ0FBQyxLQUFLLENBQUUs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LENBQUMsT0FBTyxDQUFFLElBQUksRUFBRSxhQUFhLENBQUUsQ0FBQztJQUV4QyxDQUFDOztnREF6SWEsTUFBTSxTQUFFLHVCQUF1Qjs7SUEySWpELHNCQUFDO0NBQUEsQUFwSkQsSUFvSkM7U0FwSlksZUFBZSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEluamVjdCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBJbmplY3Rpb25Ub2tlbiB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5cclxuZXhwb3J0IGludGVyZmFjZSBGYXZpY29uc0NvbmZpZyB7XHJcbiAgICBpY29uczogSWNvbnNDb25maWc7XHJcbiAgICBjYWNoZUJ1c3Rpbmc/OiBib29sZWFuO1xyXG59XHJcblxyXG5leHBvcnQgaW50ZXJmYWNlIEljb25zQ29uZmlnIHtcclxuICAgIFsgbmFtZTogc3RyaW5nIF06IEljb25Db25maWc7XHJcbn1cclxuXHJcbmV4cG9ydCBpbnRlcmZhY2UgSWNvbkNvbmZpZyB7XHJcbiAgICB0eXBlOiBzdHJpbmc7XHJcbiAgICBocmVmOiBzdHJpbmc7XHJcbiAgICBpc0RlZmF1bHQ/OiBib29sZWFuO1xyXG59XHJcblxyXG5leHBvcnQgbGV0IEJST1dTRVJfRkFWSUNPTlNfQ09ORklHID0gbmV3IEluamVjdGlvblRva2VuPEZhdmljb25zQ29uZmlnPiggJ0Zhdmljb25zIENvbmZpZ3VyYXRpb24nICk7XHJcblxyXG4vKipcclxuICogQWJzdHJhY3QgY2xhc3MgdGhhdCBhY3RzIGFzIGJvdGggaW50ZXJmYWNlIGZvciBpbXBsZW1lbnRhdGlvbiBhbmQgYXMgdGhlIGRlcGVuZGVuY3ktaW5qZWN0aW9uXHJcbiAqL1xyXG5leHBvcnQgYWJzdHJhY3QgY2xhc3MgRmF2aWNvbnNTZXJ2aWNlIHtcclxuICAgIGFic3RyYWN0IGFjdGl2YXRlKCBuYW1lOiBzdHJpbmcgKTogdm9pZDtcclxuICAgIGFic3RyYWN0IHJlc2V0KCk6IHZvaWQ7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBQcm92aWRlIHRoZSBicm93c2VyLW9yaWVudGVkIGltcGxlbWVudGF0aW9uIG9mIHRoZSBGYXZpY29ucyBjbGFzc1xyXG4gKi9cclxuZXhwb3J0IGNsYXNzIEJyb3dzZXJGYXZpY29ucyBpbXBsZW1lbnRzIEZhdmljb25zU2VydmljZSB7XHJcblxyXG4gICAgcHJvdGVjdGVkIGVsZW1lbnRJZDogc3RyaW5nO1xyXG4gICAgcHJvdGVjdGVkIGljb25zOiBJY29uc0NvbmZpZztcclxuICAgIHByb3RlY3RlZCB1c2VDYWNoZUJ1c3Rpbmc6IGJvb2xlYW47XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBpbml0aWFsaXplIHRoZSBGYXZpY29ucyBzZXJ2aWNlLlxyXG4gICAgICovXHJcbiAgICBjb25zdHJ1Y3RvciggQEluamVjdCggQlJPV1NFUl9GQVZJQ09OU19DT05GSUcgKSBjb25maWc6IEZhdmljb25zQ29uZmlnICkge1xyXG5cclxuICAgICAgICB0aGlzLmVsZW1lbnRJZCA9ICdmYXZpY29ucy1zZXJ2aWNlLWluamVjdGVkLW5vZGUnO1xyXG4gICAgICAgIHRoaXMuaWNvbnMgPSBPYmplY3QuYXNzaWduKCBPYmplY3QuY3JlYXRlKCBudWxsICksIGNvbmZpZy5pY29ucyApO1xyXG4gICAgICAgIHRoaXMudXNlQ2FjaGVCdXN0aW5nID0gKCBjb25maWcuY2FjaGVCdXN0aW5nIHx8IGZhbHNlICk7XHJcblxyXG4gICAgICAgIC8vIFNpbmNlIHRoZSBkb2N1bWVudCBtYXkgaGF2ZSBhIHN0YXRpYyBmYXZpY29uIGRlZmluaXRpb24sIHdlIHdhbnQgdG8gc3RyaXAgb3V0XHJcbiAgICAgICAgLy8gYW55IGV4aXNpdG5nIGVsZW1lbnRzIHRoYXQgYXJlIGF0dGVtcHRpbmcgdG8gZGVmaW5lIGEgZmF2aWNvbi4gVGhpcyB3YXksIHRoZXJlXHJcbiAgICAgICAgLy8gaXMgb25seSBvbmUgZmF2aWNvbiBlbGVtZW50IG9uIHRoZSBwYWdlIGF0IGEgdGltZS5cclxuICAgICAgICB0aGlzLnJlbW92ZUV4dGVybmFsTGlua0VsZW1lbnRzKCk7XHJcblxyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogQWN0aXZlIGZhdmljb24gd2l0aCBnaXZlbiBpZGVudGlmaWVyXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIG5hbWUgZmF2aWNvbiBuYW1lXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBhY3RpdmF0ZSggbmFtZTogc3RyaW5nICk6IHZvaWQge1xyXG5cclxuICAgICAgICBpZiAoICEgdGhpcy5pY29uc1sgbmFtZSBdICkge1xyXG5cclxuICAgICAgICAgICAgdGhyb3coIG5ldyBFcnJvciggYEZhdmljb24gZm9yIFsgJHsgbmFtZSB9IF0gbm90IGZvdW5kLmAgKSApO1xyXG5cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMuc2V0Tm9kZSggdGhpcy5pY29uc1sgbmFtZSBdLnR5cGUsIHRoaXMuaWNvbnNbIG5hbWUgXS5ocmVmICk7XHJcblxyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogQWN0aXZhdGUgdGhlIGRlZmF1bHQgZmF2aWNvbiAod2l0aCBpc0RlZmF1bHQgc2V0IHRvIFRydWUpXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyByZXNldCgpOiB2b2lkIHtcclxuXHJcbiAgICAgICAgZm9yICggY29uc3QgbmFtZSBvZiBPYmplY3Qua2V5cyggdGhpcy5pY29ucyApICkge1xyXG5cclxuICAgICAgICAgICAgY29uc3QgaWNvbiA9IHRoaXMuaWNvbnNbIG5hbWUgXTtcclxuXHJcbiAgICAgICAgICAgIGlmICggaWNvbi5pc0RlZmF1bHQgKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgdGhpcy5zZXROb2RlKCBpY29uLnR5cGUsIGljb24uaHJlZiApO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG5cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIElmIHdlIG1hZGUgaXQgdGhpcyBmYXIsIG5vbmUgb2YgdGhlIGZhdmljb25zIHdlcmUgZmxhZ2dlZCBhcyBkZWZhdWx0LiBJbiB0aGF0XHJcbiAgICAgICAgLy8gY2FzZSwgbGV0J3MganVzdCByZW1vdmUgdGhlIGZhdmljb24gbm9kZSBhbHRvZ2V0aGVyLlxyXG4gICAgICAgIHRoaXMucmVtb3ZlTm9kZSgpO1xyXG5cclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIEluamVjdCB0aGUgZmF2aWNvbiBlbGVtZW50IGludG8gdGhlIGRvY3VtZW50IGhlYWRlclxyXG4gICAgICogXHJcbiAgICAgKiBAcGFyYW0gdHlwZSB0eXBlIG9mIGljb24gKC5wbmcsIC5qcGVnLCBldGMpXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIGhyZWYgbG9jYXRpb25cclxuICAgICAqL1xyXG4gICAgcHJvdGVjdGVkIGFkZE5vZGUoIHR5cGU6IHN0cmluZywgaHJlZjogc3RyaW5nICk6IHZvaWQge1xyXG5cclxuICAgICAgICBjb25zdCBsaW5rRWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoICdsaW5rJyApO1xyXG4gICAgICAgIGxpbmtFbGVtZW50LnNldEF0dHJpYnV0ZSggJ2lkJywgdGhpcy5lbGVtZW50SWQgKTtcclxuICAgICAgICBsaW5rRWxlbWVudC5zZXRBdHRyaWJ1dGUoICdyZWwnLCAnaWNvbicgKTtcclxuICAgICAgICBsaW5rRWxlbWVudC5zZXRBdHRyaWJ1dGUoICd0eXBlJywgdHlwZSApO1xyXG4gICAgICAgIGxpbmtFbGVtZW50LnNldEF0dHJpYnV0ZSggJ2hyZWYnLCBocmVmICk7XHJcbiAgICAgICAgZG9jdW1lbnQuaGVhZC5hcHBlbmRDaGlsZCggbGlua0VsZW1lbnQgKTtcclxuXHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBSZXR1cm4gYW4gYXVnbWVudGVkIEhSRUYgdmFsdWUgd2l0aCBhIGNhY2hlLWJ1c3RpbmcgcXVlcnktc3RyaW5nIHBhcmFtZXRlclxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSBocmVmIGxvY2F0aW9uXHJcbiAgICAgKi9cclxuICAgIHByb3RlY3RlZCBjYWNoZUJ1c3RIcmVmKCBocmVmOiBzdHJpbmcgKTogc3RyaW5nIHtcclxuXHJcbiAgICAgICAgY29uc3QgYXVnbWVudGVkSHJlZiA9ICggaHJlZi5pbmRleE9mKCAnPycgKSA9PT0gLTEgKVxyXG4gICAgICAgICAgICA/IGAkeyBocmVmIH0/ZmF2aWNvbkNhY2hlQnVzdD0keyBEYXRlLm5vdygpIH1gXHJcbiAgICAgICAgICAgIDogYCR7IGhyZWYgfSZmYXZpY29uQ2FjaGVCdXN0PSR7IERhdGUubm93KCkgfWBcclxuICAgICAgICA7XHJcblxyXG4gICAgICAgIHJldHVybiggYXVnbWVudGVkSHJlZiApO1xyXG5cclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIEkgcmVtb3ZlIGFueSBmYXZpY29uIG5vZGVzIHRoYXQgYXJlIG5vdCBjb250cm9sbGVkIGJ5IHRoaXMgc2VydmljZVxyXG4gICAgICovXHJcbiAgICBwcm90ZWN0ZWQgcmVtb3ZlRXh0ZXJuYWxMaW5rRWxlbWVudHMoKTogdm9pZCB7XHJcblxyXG4gICAgICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTpwcmVmZXItY29uc3RcclxuICAgICAgICBsZXQgbGlua0VsZW1lbnRzOiBOb2RlTGlzdE9mPEVsZW1lbnQ+ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCggYGxpbmtbIHJlbCB+PSAnaWNvbicgaV1gICk7XHJcblxyXG4gICAgICAgIGZvciAoIGNvbnN0IGxpbmtFbGVtZW50IG9mIEFycmF5LmZyb20oIGxpbmtFbGVtZW50cyApICkge1xyXG5cclxuICAgICAgICAgICAgbGlua0VsZW1lbnQucGFyZW50Tm9kZS5yZW1vdmVDaGlsZCggbGlua0VsZW1lbnQgKTtcclxuXHJcbiAgICAgICAgfVxyXG5cclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIFJlbW92ZSB0aGUgZmF2aWNvbiBub2RlIGZyb20gdGhlIGRvY3VtZW50IGhlYWRlclxyXG4gICAgICovXHJcbiAgICBwcm90ZWN0ZWQgcmVtb3ZlTm9kZSgpOiB2b2lkIHtcclxuXHJcbiAgICAgICAgY29uc3QgbGlua0VsZW1lbnQgPSBkb2N1bWVudC5oZWFkLnF1ZXJ5U2VsZWN0b3IoICcjJyArIHRoaXMuZWxlbWVudElkICk7XHJcblxyXG4gICAgICAgIGlmICggbGlua0VsZW1lbnQgKSB7XHJcblxyXG4gICAgICAgICAgICBkb2N1bWVudC5oZWFkLnJlbW92ZUNoaWxkKCBsaW5rRWxlbWVudCApO1xyXG5cclxuICAgICAgICB9XHJcblxyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogUmVtb3ZlIGV4aXN0aW5nIGZhdmljb24gbm9kZSBhbmQgaW5qZWN0IGEgbmV3IGZhdmljb24gbm9kZSB3aXRoIHRoZSBnaXZlXHJcbiAgICAgKiBlbGVtZXQgc2V0dGluZ3NcclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0gdHlwZSB0eXBlIG9mIGZhdmljb25cclxuICAgICAqIEBwYXJhbSBocmVmIGxvY2F0aW9uXHJcbiAgICAgKi9cclxuXHJcbiAgICBwcm90ZWN0ZWQgc2V0Tm9kZSggdHlwZTogc3RyaW5nLCBocmVmOiBzdHJpbmcgKTogdm9pZCB7XHJcblxyXG4gICAgICAgIGNvbnN0IGF1Z21lbnRlZEhyZWYgPSB0aGlzLnVzZUNhY2hlQnVzdGluZ1xyXG4gICAgICAgICAgICA/IHRoaXMuY2FjaGVCdXN0SHJlZiggaHJlZiApXHJcbiAgICAgICAgICAgIDogaHJlZlxyXG4gICAgICAgIDtcclxuXHJcbiAgICAgICAgdGhpcy5yZW1vdmVOb2RlKCk7XHJcbiAgICAgICAgdGhpcy5hZGROb2RlKCB0eXBlLCBhdWdtZW50ZWRIcmVmICk7XHJcblxyXG4gICAgfVxyXG5cclxufVxyXG4iXX0=