import { Inject } from '@angular/core';
import { InjectionToken } from '@angular/core';
export let BROWSER_FAVICONS_CONFIG = new InjectionToken('Favicons Configuration');
/**
 * Abstract class that acts as both interface for implementation and as the dependency-injection
 */
export class FaviconsService {
}
/**
 * Provide the browser-oriented implementation of the Favicons class
 */
export class BrowserFavicons {
    /**
     * initialize the Favicons service.
     */
    constructor(config) {
        this.elementId = 'favicons-service-injected-node';
        this.icons = Object.assign(Object.create(null), config.icons);
        this.useCacheBusting = (config.cacheBusting || false);
        // Since the document may have a static favicon definition, we want to strip out
        // any exisitng elements that are attempting to define a favicon. This way, there
        // is only one favicon element on the page at a time.
        this.removeExternalLinkElements();
    }
    /**
     * Active favicon with given identifier
     *
     * @param name favicon name
     */
    activate(name) {
        if (!this.icons[name]) {
            throw (new Error(`Favicon for [ ${name} ] not found.`));
        }
        this.setNode(this.icons[name].type, this.icons[name].href);
    }
    /**
     * Activate the default favicon (with isDefault set to True)
     */
    reset() {
        for (const name of Object.keys(this.icons)) {
            const icon = this.icons[name];
            if (icon.isDefault) {
                this.setNode(icon.type, icon.href);
                return;
            }
        }
        // If we made it this far, none of the favicons were flagged as default. In that
        // case, let's just remove the favicon node altogether.
        this.removeNode();
    }
    /**
     * Inject the favicon element into the document header
     *
     * @param type type of icon (.png, .jpeg, etc)
     *
     * @param href location
     */
    addNode(type, href) {
        const linkElement = document.createElement('link');
        linkElement.setAttribute('id', this.elementId);
        linkElement.setAttribute('rel', 'icon');
        linkElement.setAttribute('type', type);
        linkElement.setAttribute('href', href);
        document.head.appendChild(linkElement);
    }
    /**
     * Return an augmented HREF value with a cache-busting query-string parameter
     *
     * @param href location
     */
    cacheBustHref(href) {
        const augmentedHref = (href.indexOf('?') === -1)
            ? `${href}?faviconCacheBust=${Date.now()}`
            : `${href}&faviconCacheBust=${Date.now()}`;
        return (augmentedHref);
    }
    /**
     * I remove any favicon nodes that are not controlled by this service
     */
    removeExternalLinkElements() {
        // tslint:disable-next-line:prefer-const
        let linkElements = document.querySelectorAll(`link[ rel ~= 'icon' i]`);
        for (const linkElement of Array.from(linkElements)) {
            linkElement.parentNode.removeChild(linkElement);
        }
    }
    /**
     * Remove the favicon node from the document header
     */
    removeNode() {
        const linkElement = document.head.querySelector('#' + this.elementId);
        if (linkElement) {
            document.head.removeChild(linkElement);
        }
    }
    /**
     * Remove existing favicon node and inject a new favicon node with the give
     * elemet settings
     *
     * @param type type of favicon
     * @param href location
     */
    setNode(type, href) {
        const augmentedHref = this.useCacheBusting
            ? this.cacheBustHref(href)
            : href;
        this.removeNode();
        this.addNode(type, augmentedHref);
    }
}
BrowserFavicons.ctorParameters = () => [
    { type: undefined, decorators: [{ type: Inject, args: [BROWSER_FAVICONS_CONFIG,] }] }
];
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmF2aWNvbnMuc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BsY3UvY29tbW9uLyIsInNvdXJjZXMiOlsibGliL3V0aWxzL2Zhdmljb25zLnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLE1BQU0sRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUN2QyxPQUFPLEVBQUUsY0FBYyxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBaUIvQyxNQUFNLENBQUMsSUFBSSx1QkFBdUIsR0FBRyxJQUFJLGNBQWMsQ0FBa0Isd0JBQXdCLENBQUUsQ0FBQztBQUVwRzs7R0FFRztBQUNILE1BQU0sT0FBZ0IsZUFBZTtDQUdwQztBQUVEOztHQUVHO0FBQ0gsTUFBTSxPQUFPLGVBQWU7SUFNeEI7O09BRUc7SUFDSCxZQUFnRCxNQUFzQjtRQUVsRSxJQUFJLENBQUMsU0FBUyxHQUFHLGdDQUFnQyxDQUFDO1FBQ2xELElBQUksQ0FBQyxLQUFLLEdBQUcsTUFBTSxDQUFDLE1BQU0sQ0FBRSxNQUFNLENBQUMsTUFBTSxDQUFFLElBQUksQ0FBRSxFQUFFLE1BQU0sQ0FBQyxLQUFLLENBQUUsQ0FBQztRQUNsRSxJQUFJLENBQUMsZUFBZSxHQUFHLENBQUUsTUFBTSxDQUFDLFlBQVksSUFBSSxLQUFLLENBQUUsQ0FBQztRQUV4RCxnRkFBZ0Y7UUFDaEYsaUZBQWlGO1FBQ2pGLHFEQUFxRDtRQUNyRCxJQUFJLENBQUMsMEJBQTBCLEVBQUUsQ0FBQztJQUV0QyxDQUFDO0lBRUQ7Ozs7T0FJRztJQUNJLFFBQVEsQ0FBRSxJQUFZO1FBRXpCLElBQUssQ0FBRSxJQUFJLENBQUMsS0FBSyxDQUFFLElBQUksQ0FBRSxFQUFHO1lBRXhCLE1BQUssQ0FBRSxJQUFJLEtBQUssQ0FBRSxpQkFBa0IsSUFBSyxlQUFlLENBQUUsQ0FBRSxDQUFDO1NBRWhFO1FBRUQsSUFBSSxDQUFDLE9BQU8sQ0FBRSxJQUFJLENBQUMsS0FBSyxDQUFFLElBQUksQ0FBRSxDQUFDLElBQUks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ZSc7XHJcbmltcG9ydCB7IEluamVjdGlvblRva2VuIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcblxyXG5leHBvcnQgaW50ZXJmYWNlIEZhdmljb25zQ29uZmlnIHtcclxuICAgIGljb25zOiBJY29uc0NvbmZpZztcclxuICAgIGNhY2hlQnVzdGluZz86IGJvb2xlYW47XHJcbn1cclxuXHJcbmV4cG9ydCBpbnRlcmZhY2UgSWNvbnNDb25maWcge1xyXG4gICAgWyBuYW1lOiBzdHJpbmcgXTogSWNvbkNvbmZpZztcclxufVxyXG5cclxuZXhwb3J0IGludGVyZmFjZSBJY29uQ29uZmlnIHtcclxuICAgIHR5cGU6IHN0cmluZztcclxuICAgIGhyZWY6IHN0cmluZztcclxuICAgIGlzRGVmYXVsdD86IGJvb2xlYW47XHJcbn1cclxuXHJcbmV4cG9ydCBsZXQgQlJPV1NFUl9GQVZJQ09OU19DT05GSUcgPSBuZXcgSW5qZWN0aW9uVG9rZW48RmF2aWNvbnNDb25maWc+KCAnRmF2aWNvbnMgQ29uZmlndXJhdGlvbicgKTtcclxuXHJcbi8qKlxyXG4gKiBBYnN0cmFjdCBjbGFzcyB0aGF0IGFjdHMgYXMgYm90aCBpbnRlcmZhY2UgZm9yIGltcGxlbWVudGF0aW9uIGFuZCBhcyB0aGUgZGVwZW5kZW5jeS1pbmplY3Rpb25cclxuICovXHJcbmV4cG9ydCBhYnN0cmFjdCBjbGFzcyBGYXZpY29uc1NlcnZpY2Uge1xyXG4gICAgYWJzdHJhY3QgYWN0aXZhdGUoIG5hbWU6IHN0cmluZyApOiB2b2lkO1xyXG4gICAgYWJzdHJhY3QgcmVzZXQoKTogdm9pZDtcclxufVxyXG5cclxuLyoqXHJcbiAqIFByb3ZpZGUgdGhlIGJyb3dzZXItb3JpZW50ZWQgaW1wbGVtZW50YXRpb24gb2YgdGhlIEZhdmljb25zIGNsYXNzXHJcbiAqL1xyXG5leHBvcnQgY2xhc3MgQnJvd3NlckZhdmljb25zIGltcGxlbWVudHMgRmF2aWNvbnNTZXJ2aWNlIHtcclxuXHJcbiAgICBwcm90ZWN0ZWQgZWxlbWVudElkOiBzdHJpbmc7XHJcbiAgICBwcm90ZWN0ZWQgaWNvbnM6IEljb25zQ29uZmlnO1xyXG4gICAgcHJvdGVjdGVkIHVzZUNhY2hlQnVzdGluZzogYm9vbGVhbjtcclxuXHJcbiAgICAvKipcclxuICAgICAqIGluaXRpYWxpemUgdGhlIEZhdmljb25zIHNlcnZpY2UuXHJcbiAgICAgKi9cclxuICAgIGNvbnN0cnVjdG9yKCBASW5qZWN0KCBCUk9XU0VSX0ZBVklDT05TX0NPTkZJRyApIGNvbmZpZzogRmF2aWNvbnNDb25maWcgKSB7XHJcblxyXG4gICAgICAgIHRoaXMuZWxlbWVudElkID0gJ2Zhdmljb25zLXNlcnZpY2UtaW5qZWN0ZWQtbm9kZSc7XHJcbiAgICAgICAgdGhpcy5pY29ucyA9IE9iamVjdC5hc3NpZ24oIE9iamVjdC5jcmVhdGUoIG51bGwgKSwgY29uZmlnLmljb25zICk7XHJcbiAgICAgICAgdGhpcy51c2VDYWNoZUJ1c3RpbmcgPSAoIGNvbmZpZy5jYWNoZUJ1c3RpbmcgfHwgZmFsc2UgKTtcclxuXHJcbiAgICAgICAgLy8gU2luY2UgdGhlIGRvY3VtZW50IG1heSBoYXZlIGEgc3RhdGljIGZhdmljb24gZGVmaW5pdGlvbiwgd2Ugd2FudCB0byBzdHJpcCBvdXRcclxuICAgICAgICAvLyBhbnkgZXhpc2l0bmcgZWxlbWVudHMgdGhhdCBhcmUgYXR0ZW1wdGluZyB0byBkZWZpbmUgYSBmYXZpY29uLiBUaGlzIHdheSwgdGhlcmVcclxuICAgICAgICAvLyBpcyBvbmx5IG9uZSBmYXZpY29uIGVsZW1lbnQgb24gdGhlIHBhZ2UgYXQgYSB0aW1lLlxyXG4gICAgICAgIHRoaXMucmVtb3ZlRXh0ZXJuYWxMaW5rRWxlbWVudHMoKTtcclxuXHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBBY3RpdmUgZmF2aWNvbiB3aXRoIGdpdmVuIGlkZW50aWZpZXJcclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0gbmFtZSBmYXZpY29uIG5hbWVcclxuICAgICAqL1xyXG4gICAgcHVibGljIGFjdGl2YXRlKCBuYW1lOiBzdHJpbmcgKTogdm9pZCB7XHJcblxyXG4gICAgICAgIGlmICggISB0aGlzLmljb25zWyBuYW1lIF0gKSB7XHJcblxyXG4gICAgICAgICAgICB0aHJvdyggbmV3IEVycm9yKCBgRmF2aWNvbiBmb3IgWyAkeyBuYW1lIH0gXSBub3QgZm91bmQuYCApICk7XHJcblxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy5zZXROb2RlKCB0aGlzLmljb25zWyBuYW1lIF0udHlwZSwgdGhpcy5pY29uc1sgbmFtZSBdLmhyZWYgKTtcclxuXHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBBY3RpdmF0ZSB0aGUgZGVmYXVsdCBmYXZpY29uICh3aXRoIGlzRGVmYXVsdCBzZXQgdG8gVHJ1ZSlcclxuICAgICAqL1xyXG4gICAgcHVibGljIHJlc2V0KCk6IHZvaWQge1xyXG5cclxuICAgICAgICBmb3IgKCBjb25zdCBuYW1lIG9mIE9iamVjdC5rZXlzKCB0aGlzLmljb25zICkgKSB7XHJcblxyXG4gICAgICAgICAgICBjb25zdCBpY29uID0gdGhpcy5pY29uc1sgbmFtZSBdO1xyXG5cclxuICAgICAgICAgICAgaWYgKCBpY29uLmlzRGVmYXVsdCApIHtcclxuXHJcbiAgICAgICAgICAgICAgICB0aGlzLnNldE5vZGUoIGljb24udHlwZSwgaWNvbi5ocmVmICk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcblxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gSWYgd2UgbWFkZSBpdCB0aGlzIGZhciwgbm9uZSBvZiB0aGUgZmF2aWNvbnMgd2VyZSBmbGFnZ2VkIGFzIGRlZmF1bHQuIEluIHRoYXRcclxuICAgICAgICAvLyBjYXNlLCBsZXQncyBqdXN0IHJlbW92ZSB0aGUgZmF2aWNvbiBub2RlIGFsdG9nZXRoZXIuXHJcbiAgICAgICAgdGhpcy5yZW1vdmVOb2RlKCk7XHJcblxyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogSW5qZWN0IHRoZSBmYXZpY29uIGVsZW1lbnQgaW50byB0aGUgZG9jdW1lbnQgaGVhZGVyXHJcbiAgICAgKiBcclxuICAgICAqIEBwYXJhbSB0eXBlIHR5cGUgb2YgaWNvbiAoLnBuZywgLmpwZWcsIGV0YylcclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0gaHJlZiBsb2NhdGlvblxyXG4gICAgICovXHJcbiAgICBwcm90ZWN0ZWQgYWRkTm9kZSggdHlwZTogc3RyaW5nLCBocmVmOiBzdHJpbmcgKTogdm9pZCB7XHJcblxyXG4gICAgICAgIGNvbnN0IGxpbmtFbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCggJ2xpbmsnICk7XHJcbiAgICAgICAgbGlua0VsZW1lbnQuc2V0QXR0cmlidXRlKCAnaWQnLCB0aGlzLmVsZW1lbnRJZCApO1xyXG4gICAgICAgIGxpbmtFbGVtZW50LnNldEF0dHJpYnV0ZSggJ3JlbCcsICdpY29uJyApO1xyXG4gICAgICAgIGxpbmtFbGVtZW50LnNldEF0dHJpYnV0ZSggJ3R5cGUnLCB0eXBlICk7XHJcbiAgICAgICAgbGlua0VsZW1lbnQuc2V0QXR0cmlidXRlKCAnaHJlZicsIGhyZWYgKTtcclxuICAgICAgICBkb2N1bWVudC5oZWFkLmFwcGVuZENoaWxkKCBsaW5rRWxlbWVudCApO1xyXG5cclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIFJldHVybiBhbiBhdWdtZW50ZWQgSFJFRiB2YWx1ZSB3aXRoIGEgY2FjaGUtYnVzdGluZyBxdWVyeS1zdHJpbmcgcGFyYW1ldGVyXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIGhyZWYgbG9jYXRpb25cclxuICAgICAqL1xyXG4gICAgcHJvdGVjdGVkIGNhY2hlQnVzdEhyZWYoIGhyZWY6IHN0cmluZyApOiBzdHJpbmcge1xyXG5cclxuICAgICAgICBjb25zdCBhdWdtZW50ZWRIcmVmID0gKCBocmVmLmluZGV4T2YoICc/JyApID09PSAtMSApXHJcbiAgICAgICAgICAgID8gYCR7IGhyZWYgfT9mYXZpY29uQ2FjaGVCdXN0PSR7IERhdGUubm93KCkgfWBcclxuICAgICAgICAgICAgOiBgJHsgaHJlZiB9JmZhdmljb25DYWNoZUJ1c3Q9JHsgRGF0ZS5ub3coKSB9YFxyXG4gICAgICAgIDtcclxuXHJcbiAgICAgICAgcmV0dXJuKCBhdWdtZW50ZWRIcmVmICk7XHJcblxyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogSSByZW1vdmUgYW55IGZhdmljb24gbm9kZXMgdGhhdCBhcmUgbm90IGNvbnRyb2xsZWQgYnkgdGhpcyBzZXJ2aWNlXHJcbiAgICAgKi9cclxuICAgIHByb3RlY3RlZCByZW1vdmVFeHRlcm5hbExpbmtFbGVtZW50cygpOiB2b2lkIHtcclxuXHJcbiAgICAgICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOnByZWZlci1jb25zdFxyXG4gICAgICAgIGxldCBsaW5rRWxlbWVudHM6IE5vZGVMaXN0T2Y8RWxlbWVudD4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCBgbGlua1sgcmVsIH49ICdpY29uJyBpXWAgKTtcclxuXHJcbiAgICAgICAgZm9yICggY29uc3QgbGlua0VsZW1lbnQgb2YgQXJyYXkuZnJvbSggbGlua0VsZW1lbnRzICkgKSB7XHJcblxyXG4gICAgICAgICAgICBsaW5rRWxlbWVudC5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKCBsaW5rRWxlbWVudCApO1xyXG5cclxuICAgICAgICB9XHJcblxyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogUmVtb3ZlIHRoZSBmYXZpY29uIG5vZGUgZnJvbSB0aGUgZG9jdW1lbnQgaGVhZGVyXHJcbiAgICAgKi9cclxuICAgIHByb3RlY3RlZCByZW1vdmVOb2RlKCk6IHZvaWQge1xyXG5cclxuICAgICAgICBjb25zdCBsaW5rRWxlbWVudCA9IGRvY3VtZW50LmhlYWQucXVlcnlTZWxlY3RvciggJyMnICsgdGhpcy5lbGVtZW50SWQgKTtcclxuXHJcbiAgICAgICAgaWYgKCBsaW5rRWxlbWVudCApIHtcclxuXHJcbiAgICAgICAgICAgIGRvY3VtZW50LmhlYWQucmVtb3ZlQ2hpbGQoIGxpbmtFbGVtZW50ICk7XHJcblxyXG4gICAgICAgIH1cclxuXHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBSZW1vdmUgZXhpc3RpbmcgZmF2aWNvbiBub2RlIGFuZCBpbmplY3QgYSBuZXcgZmF2aWNvbiBub2RlIHdpdGggdGhlIGdpdmVcclxuICAgICAqIGVsZW1ldCBzZXR0aW5nc1xyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSB0eXBlIHR5cGUgb2YgZmF2aWNvblxyXG4gICAgICogQHBhcmFtIGhyZWYgbG9jYXRpb25cclxuICAgICAqL1xyXG5cclxuICAgIHByb3RlY3RlZCBzZXROb2RlKCB0eXBlOiBzdHJpbmcsIGhyZWY6IHN0cmluZyApOiB2b2lkIHtcclxuXHJcbiAgICAgICAgY29uc3QgYXVnbWVudGVkSHJlZiA9IHRoaXMudXNlQ2FjaGVCdXN0aW5nXHJcbiAgICAgICAgICAgID8gdGhpcy5jYWNoZUJ1c3RIcmVmKCBocmVmIClcclxuICAgICAgICAgICAgOiBocmVmXHJcbiAgICAgICAgO1xyXG5cclxuICAgICAgICB0aGlzLnJlbW92ZU5vZGUoKTtcclxuICAgICAgICB0aGlzLmFkZE5vZGUoIHR5cGUsIGF1Z21lbnRlZEhyZWYgKTtcclxuXHJcbiAgICB9XHJcblxyXG59XHJcbiJdfQ==