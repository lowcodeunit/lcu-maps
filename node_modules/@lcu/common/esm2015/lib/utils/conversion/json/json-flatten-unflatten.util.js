import { IsDataTypeUtil } from './../../type/is-data-type.util';
// @dynamic
/**
 * @dynamic is used because this class contains static properties
 */
/**
 * Flatten and Unflatten JSON
 *
 * Original Code Example: http://jsfiddle.net/crl/WSzec/154/
 */
export class JSONFlattenUnflatten {
    /**
     * Flatten a standard JSON Object
     *
     * @param json JSON object to be flattened
     *
     * @param map recursive map data
     *
     * @param prefix dotnotated path
     */
    static Flatten(json, map = {}, prefix = '') {
        if (Array.isArray(json)) {
            json.forEach((itm, idx) => {
                if (IsDataTypeUtil.IsObject(json[itm]) && json[itm]) {
                    this.Flatten(json[itm], map, prefix + '[' + itm + ']');
                }
                else {
                    map[prefix + '[' + itm + ']'] = json[itm];
                }
            });
            return map;
        }
        Object.entries(json).forEach(([key, value]) => {
            if (IsDataTypeUtil.IsObject(json[key]) && json[key]) {
                this.Flatten(json[key], map, (prefix ? prefix + '.' : '') + key);
            }
            else {
                map[(prefix ? prefix + '.' : '') + key] = json[key];
            }
        });
        return map;
    }
    /**
     * Flatten JSON into a map
     *
     * @param json JSON object to be flattened
     *
     * @param map recursive map data
     *
     * @param prefix dotnotated path
     */
    static FlattenMap(json, map = new Map(), prefix = '') {
        if (Array.isArray(json)) {
            json.forEach((itm, idx) => {
                if (IsDataTypeUtil.IsObject(json[itm]) && json[itm]) {
                    this.FlattenMap(json[itm], map, prefix + '[' + itm + ']');
                }
                else {
                    map.set(prefix + '[' + itm + ']', json[itm]);
                }
            });
            return map;
        }
        Object.entries(json).forEach(([key, value]) => {
            if (IsDataTypeUtil.IsObject(json[key]) && json[key]) {
                if (Object.entries(json[key]).length === 0) {
                    return;
                }
                this.FlattenMap(json[key], map, (prefix ? prefix + '.' : '') + key);
            }
            else {
                map.set((prefix ? prefix + '.' : '') + key, json[key]);
            }
        });
        return map;
    }
    /**
     * Flatten JSON into a map
     *
     * @param json JSON object to be flattened
     *
     * @param map recursive map data
     *
     * @param prefix dotnotated path
     */
    static FlattenMapTest(json, map = new Map(), prefix = '') {
        if (Array.isArray(json)) {
            json.forEach((itm, idx) => {
                if (IsDataTypeUtil.IsObject(json[itm]) && json[itm]) {
                    this.FlattenMap(json[itm], map, prefix + '[' + itm + ']');
                }
                else {
                    map.set(prefix + '[' + itm + ']', json[itm]);
                }
            });
            return map;
        }
        Object.entries(json).forEach(([key, value]) => {
            if (IsDataTypeUtil.IsObject(json[key]) && json[key]) {
                if (Object.entries(json[key]).length === 0) {
                    return;
                }
                this.FlattenMapTest(json[key], map, (prefix ? prefix + '.' : '') + key);
            }
            else {
                map.set((prefix ? prefix + '.' : '') + key, json[key]);
            }
        });
        return map;
    }
    /**
     * Flatten JSON into a map
     *
     * @param json JSON object to be flattened
     *
     * @param map recursive map data
     *
     * @param prefix dotnotated path
     */
    static FlattenMapJSONSchemaItem(json, map = new Map(), prefix = '') {
        if (Array.isArray(json)) {
            json.forEach((itm, idx) => {
                if (IsDataTypeUtil.IsObject(json[itm]) && json[itm]) {
                    this.FlattenMap(json[itm], map, prefix + '[' + itm + ']');
                }
                else {
                    map.set(prefix + '[' + itm + ']', json[itm]);
                }
            });
            return map;
        }
        Object.entries(json).forEach(([key, value]) => {
            if (IsDataTypeUtil.IsObject(json[key]) && json[key]) {
                this.FlattenMap(json[key], map, (prefix ? prefix + '.' : '') + key);
            }
            else {
                map.set((prefix ? prefix + '.' : '') + key, json[key]);
            }
        });
        return map;
    }
    /**
     * Unflatten an already flatten JSON object
     *
     * @param map object to unflatten
     */
    static Unflatten(map) {
        const returnObject = {};
        Object.entries(map).forEach(([key, value]) => {
            const keysRegEx = /(?:\.?([^.[]+))|(\[\d+\])/g;
            let match;
            let oi = returnObject; // ref to returnObject, modified in loop below
            // tslint:disable-next-line:no-conditional-assignment
            while (match = keysRegEx.exec(key)) { // method executes a search for a match in a specified string. Returns a result array,
                const prefix = key[match.index + match[0].length];
                let keyName = match[1];
                if (!prefix) { // nothing more, store value in oi[keyName]
                    oi[keyName] = value;
                }
                else {
                    if (keyName) {
                        if (!oi.hasOwnProperty(keyName)) {
                            oi[keyName] = prefix === '[' ? [] : {};
                        }
                    }
                    else {
                        keyName = match[2].slice(1, -1);
                        if (!oi.hasOwnProperty(keyName)) {
                            oi[keyName] = prefix === '[' ? [] : {};
                        }
                    }
                }
                oi = oi[keyName];
            }
        });
        return returnObject;
    }
    /**
     * Unflatten map data
     *
     * @param map map data
     */
    static UnflattenMap(map) {
        const returnObject = {};
        map.forEach((value, key) => {
            const keysRegEx = /(?:\.?([^.[]+))|(\[\d+\])/g;
            let match;
            let oi = returnObject; // ref to returnObject, modified in loop below
            // tslint:disable-next-line:no-conditional-assignment
            while (match = keysRegEx.exec(key)) { // method executes a search for a match in a specified string. Returns a result array,
                const prefix = key[match.index + match[0].length];
                let keyName = match[1];
                if (!prefix) { // nothing more, store value in oi[keyName]
                    oi[keyName] = value;
                }
                else {
                    if (keyName) {
                        if (!oi.hasOwnProperty(keyName)) {
                            oi[keyName] = prefix === '[' ? [] : {};
                        }
                    }
                    else {
                        keyName = match[2].slice(1, -1);
                        if (!oi.hasOwnProperty(keyName)) {
                            oi[keyName] = prefix === '[' ? [] : {};
                        }
                    }
                }
                oi = oi[keyName];
            }
        });
        return returnObject;
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoianNvbi1mbGF0dGVuLXVuZmxhdHRlbi51dGlsLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGxjdS9jb21tb24vIiwic291cmNlcyI6WyJsaWIvdXRpbHMvY29udmVyc2lvbi9qc29uL2pzb24tZmxhdHRlbi11bmZsYXR0ZW4udXRpbC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsY0FBYyxFQUFFLE1BQU0sZ0NBQWdDLENBQUM7QUFJaEUsV0FBVztBQUVYOztHQUVHO0FBRUg7Ozs7R0FJRztBQUNILE1BQU0sT0FBTyxvQkFBb0I7SUFFL0I7Ozs7Ozs7O09BUUc7SUFDSSxNQUFNLENBQUMsT0FBTyxDQUFDLElBQXVCLEVBQUUsR0FBRyxHQUFHLEVBQUUsRUFBRSxNQUFNLEdBQUcsRUFBRTtRQUNsRSxJQUFJLEtBQUssQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLEVBQUU7WUFDdkIsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDLEdBQUcsRUFBRSxHQUFHLEVBQUUsRUFBRTtnQkFDeEIsSUFBSSxjQUFjLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRTtvQkFDbkQsSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsR0FBRyxFQUFFLE1BQU0sR0FBRyxHQUFHLEdBQUcsR0FBRyxHQUFHLEdBQUcsQ0FBQyxDQUFDO2lCQUN4RDtxQkFBTTtvQkFDTCxHQUFHLENBQUMsTUFBTSxHQUFHLEdBQUcsR0FBRyxHQUFHLEdBQUcsR0FBRyxDQUFDLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO2lCQUMzQztZQUNILENBQUMsQ0FBQyxDQUFDO1lBRUgsT0FBTyxHQUFHLENBQUM7U0FDWjtRQUVELE1BQU0sQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxHQUFHLEVBQUUsS0FBSyxDQUFDLEVBQUUs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QyxDQUFDLENBQUMsQ0FBQztnQkFFL0IsSUFBSSxDQUFDLE1BQU0sRUFBRSxFQUFFLDJDQUEyQztvQkFDdEQsRUFBRSxDQUFDLE9BQU8sQ0FBQyxHQUFHLEtBQUssQ0FBQztpQkFDdkI7cUJBQU07b0JBQ0gsSUFBSSxPQUFPLEVBQUU7d0JBQ1gsSUFBSSxDQUFDLEVBQUUsQ0FBQyxjQUFjLENBQUMsT0FBTyxDQUFDLEVBQUU7NEJBQy9CLEVBQUUsQ0FBQyxPQUFPLENBQUMsR0FBRyxNQUFNLEtBQUssR0FBRyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQzt5QkFDeEM7cUJBQ0o7eUJBQU07d0JBQ0wsT0FBTyxHQUFHLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUM7d0JBQ2hDLElBQUksQ0FBQyxFQUFFLENBQUMsY0FBYyxDQUFDLE9BQU8sQ0FBQyxFQUFFOzRCQUMvQixFQUFFLENBQUMsT0FBTyxDQUFDLEdBQUcsTUFBTSxLQUFLLEdBQUcsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUM7eUJBQ3hDO3FCQUNGO2lCQUNGO2dCQUNELEVBQUUsR0FBRyxFQUFFLENBQUMsT0FBTyxDQUFDLENBQUM7YUFDbEI7UUFDSCxDQUFDLENBQUMsQ0FBQztRQUNILE9BQU8sWUFBWSxDQUFDO0lBQ3RCLENBQUM7Q0FDSCIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IElzRGF0YVR5cGVVdGlsIH0gZnJvbSAnLi8uLi8uLi90eXBlL2lzLWRhdGEtdHlwZS51dGlsJztcclxuaW1wb3J0IHsgSlNPTlNjaGVtYSB9IGZyb20gJy4uLy4uLy4uL2pzb24tc2NoZW1hJztcclxuaW1wb3J0IHsgSlNPTlNjaGVtYUl0ZW1Nb2RlbCB9IGZyb20gJy4uLy4uLy4uL21vZGVscy9qc29uL2pzb24tc2NoZW1hLWl0ZW0ubW9kZWwnO1xyXG5cclxuLy8gQGR5bmFtaWNcclxuXHJcbi8qKlxyXG4gKiBAZHluYW1pYyBpcyB1c2VkIGJlY2F1c2UgdGhpcyBjbGFzcyBjb250YWlucyBzdGF0aWMgcHJvcGVydGllc1xyXG4gKi9cclxuXHJcbi8qKlxyXG4gKiBGbGF0dGVuIGFuZCBVbmZsYXR0ZW4gSlNPTlxyXG4gKlxyXG4gKiBPcmlnaW5hbCBDb2RlIEV4YW1wbGU6IGh0dHA6Ly9qc2ZpZGRsZS5uZXQvY3JsL1dTemVjLzE1NC9cclxuICovXHJcbmV4cG9ydCBjbGFzcyBKU09ORmxhdHRlblVuZmxhdHRlbiB7XHJcblxyXG4gIC8qKlxyXG4gICAqIEZsYXR0ZW4gYSBzdGFuZGFyZCBKU09OIE9iamVjdFxyXG4gICAqXHJcbiAgICogQHBhcmFtIGpzb24gSlNPTiBvYmplY3QgdG8gYmUgZmxhdHRlbmVkXHJcbiAgICpcclxuICAgKiBAcGFyYW0gbWFwIHJlY3Vyc2l2ZSBtYXAgZGF0YVxyXG4gICAqXHJcbiAgICogQHBhcmFtIHByZWZpeCBkb3Rub3RhdGVkIHBhdGhcclxuICAgKi9cclxuICBwdWJsaWMgc3RhdGljIEZsYXR0ZW4oanNvbjogSlNPTiB8IEpTT05TY2hlbWEsIG1hcCA9IHt9LCBwcmVmaXggPSAnJyk6IG9iamVjdCB7XHJcbiAgICBpZiAoQXJyYXkuaXNBcnJheShqc29uKSkge1xyXG4gICAgICBqc29uLmZvckVhY2goKGl0bSwgaWR4KSA9PiB7XHJcbiAgICAgICAgaWYgKElzRGF0YVR5cGVVdGlsLklzT2JqZWN0KGpzb25baXRtXSkgJiYganNvbltpdG1dKSB7XHJcbiAgICAgICAgICB0aGlzLkZsYXR0ZW4oanNvbltpdG1dLCBtYXAsIHByZWZpeCArICdbJyArIGl0bSArICddJyk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIG1hcFtwcmVmaXggKyAnWycgKyBpdG0gKyAnXSddID0ganNvbltpdG1dO1xyXG4gICAgICAgIH1cclxuICAgICAgfSk7XHJcblxyXG4gICAgICByZXR1cm4gbWFwO1xyXG4gICAgfVxyXG5cclxuICAgIE9iamVjdC5lbnRyaWVzKGpzb24pLmZvckVhY2goKFtrZXksIHZhbHVlXSkgPT4ge1xyXG4gICAgICBpZiAoSXNEYXRhVHlwZVV0aWwuSXNPYmplY3QoanNvbltrZXldKSAmJiBqc29uW2tleV0pIHtcclxuICAgICAgICB0aGlzLkZsYXR0ZW4oanNvbltrZXldLCBtYXAsIChwcmVmaXggPyBwcmVmaXggKyAnLicgOiAnJykgKyBrZXkpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIG1hcFsocHJlZml4ID8gcHJlZml4ICsgJy4nIDogJycpICsga2V5XSA9IGpzb25ba2V5XTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcblxyXG4gICAgcmV0dXJuIG1hcDtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEZsYXR0ZW4gSlNPTiBpbnRvIGEgbWFwXHJcbiAgICpcclxuICAgKiBAcGFyYW0ganNvbiBKU09OIG9iamVjdCB0byBiZSBmbGF0dGVuZWRcclxuICAgKlxyXG4gICAqIEBwYXJhbSBtYXAgcmVjdXJzaXZlIG1hcCBkYXRhXHJcbiAgICpcclxuICAgKiBAcGFyYW0gcHJlZml4IGRvdG5vdGF0ZWQgcGF0aFxyXG4gICAqL1xyXG4gIHB1YmxpYyBzdGF0aWMgRmxhdHRlbk1hcChqc29uOiBKU09OIHwgSlNPTlNjaGVtYSwgbWFwID0gbmV3IE1hcCgpLCBwcmVmaXg6IHN0cmluZyA9ICcnKTogTWFwPHN0cmluZywgc3RyaW5nPiB7XHJcbiAgICBpZiAoQXJyYXkuaXNBcnJheShqc29uKSkge1xyXG4gICAgICBqc29uLmZvckVhY2goKGl0bSwgaWR4KSA9PiB7XHJcbiAgICAgICAgaWYgKElzRGF0YVR5cGVVdGlsLklzT2JqZWN0KGpzb25baXRtXSkgJiYganNvbltpdG1dKSB7XHJcbiAgICAgICAgICB0aGlzLkZsYXR0ZW5NYXAoanNvbltpdG1dLCBtYXAsIHByZWZpeCArICdbJyArIGl0bSArICddJyk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIG1hcC5zZXQocHJlZml4ICsgJ1snICsgaXRtICsgJ10nLCBqc29uW2l0bV0pO1xyXG4gICAgICAgIH1cclxuICAgICAgfSk7XHJcblxyXG4gICAgICByZXR1cm4gbWFwO1xyXG4gICAgfVxyXG5cclxuICAgIE9iamVjdC5lbnRyaWVzKGpzb24pLmZvckVhY2goKFtrZXksIHZhbHVlXSkgPT4ge1xyXG4gICAgICBpZiAoSXNEYXRhVHlwZVV0aWwuSXNPYmplY3QoanNvbltrZXldKSAmJiBqc29uW2tleV0pIHtcclxuICAgICAgICBpZiAoT2JqZWN0LmVudHJpZXMoanNvbltrZXldKS5sZW5ndGggPT09IDApIHsgcmV0dXJuOyB9XHJcbiAgICAgICAgdGhpcy5GbGF0dGVuTWFwKGpzb25ba2V5XSwgbWFwLCAocHJlZml4ID8gcHJlZml4ICsgJy4nIDogJycpICsga2V5KTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgIG1hcC5zZXQoKHByZWZpeCA/IHByZWZpeCArICcuJyA6ICcnKSArIGtleSwganNvbltrZXldKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcblxyXG4gICAgcmV0dXJuIG1hcDtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEZsYXR0ZW4gSlNPTiBpbnRvIGEgbWFwXHJcbiAgICpcclxuICAgKiBAcGFyYW0ganNvbiBKU09OIG9iamVjdCB0byBiZSBmbGF0dGVuZWRcclxuICAgKlxyXG4gICAqIEBwYXJhbSBtYXAgcmVjdXJzaXZlIG1hcCBkYXRhXHJcbiAgICpcclxuICAgKiBAcGFyYW0gcHJlZml4IGRvdG5vdGF0ZWQgcGF0aFxyXG4gICAqL1xyXG4gIHB1YmxpYyBzdGF0aWMgRmxhdHRlbk1hcFRlc3QoanNvbjogSlNPTiB8IEpTT05TY2hlbWEsIG1hcCA9IG5ldyBNYXAoKSwgcHJlZml4OiBzdHJpbmcgPSAnJyk6IE1hcDxzdHJpbmcsIHN0cmluZz4ge1xyXG4gICAgaWYgKEFycmF5LmlzQXJyYXkoanNvbikpIHtcclxuICAgICAganNvbi5mb3JFYWNoKChpdG0sIGlkeCkgPT4ge1xyXG4gICAgICAgIGlmIChJc0RhdGFUeXBlVXRpbC5Jc09iamVjdChqc29uW2l0bV0pICYmIGpzb25baXRtXSkge1xyXG4gICAgICAgICAgdGhpcy5GbGF0dGVuTWFwKGpzb25baXRtXSwgbWFwLCBwcmVmaXggKyAnWycgKyBpdG0gKyAnXScpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICBtYXAuc2V0KHByZWZpeCArICdbJyArIGl0bSArICddJywganNvbltpdG1dKTtcclxuICAgICAgICB9XHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgcmV0dXJuIG1hcDtcclxuICAgIH1cclxuXHJcbiAgICBPYmplY3QuZW50cmllcyhqc29uKS5mb3JFYWNoKChba2V5LCB2YWx1ZV0pID0+IHtcclxuICAgICAgaWYgKElzRGF0YVR5cGVVdGlsLklzT2JqZWN0KGpzb25ba2V5XSkgJiYganNvbltrZXldKSB7XHJcbiAgICAgICAgaWYgKE9iamVjdC5lbnRyaWVzKGpzb25ba2V5XSkubGVuZ3RoID09PSAwKSB7IHJldHVybjsgfVxyXG4gICAgICAgIHRoaXMuRmxhdHRlbk1hcFRlc3QoanNvbltrZXldLCBtYXAsIChwcmVmaXggPyBwcmVmaXggKyAnLicgOiAnJykgKyBrZXkpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICBtYXAuc2V0KChwcmVmaXggPyBwcmVmaXggKyAnLicgOiAnJykgKyBrZXksIGpzb25ba2V5XSk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG5cclxuICAgIHJldHVybiBtYXA7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBGbGF0dGVuIEpTT04gaW50byBhIG1hcFxyXG4gICAqXHJcbiAgICogQHBhcmFtIGpzb24gSlNPTiBvYmplY3QgdG8gYmUgZmxhdHRlbmVkXHJcbiAgICpcclxuICAgKiBAcGFyYW0gbWFwIHJlY3Vyc2l2ZSBtYXAgZGF0YVxyXG4gICAqXHJcbiAgICogQHBhcmFtIHByZWZpeCBkb3Rub3RhdGVkIHBhdGhcclxuICAgKi9cclxuICBwdWJsaWMgc3RhdGljIEZsYXR0ZW5NYXBKU09OU2NoZW1hSXRlbShcclxuICAgIGpzb246IEpTT04gfCBKU09OU2NoZW1hLCBtYXAgPSBuZXcgTWFwKCksIHByZWZpeDogc3RyaW5nID0gJycpOiBNYXA8c3RyaW5nLCBKU09OU2NoZW1hSXRlbU1vZGVsPiB7XHJcblxyXG4gICAgaWYgKEFycmF5LmlzQXJyYXkoanNvbikpIHtcclxuICAgICAganNvbi5mb3JFYWNoKChpdG0sIGlkeCkgPT4ge1xyXG4gICAgICAgIGlmIChJc0RhdGFUeXBlVXRpbC5Jc09iamVjdChqc29uW2l0bV0pICYmIGpzb25baXRtXSkge1xyXG4gICAgICAgICAgdGhpcy5GbGF0dGVuTWFwKGpzb25baXRtXSwgbWFwLCBwcmVmaXggKyAnWycgKyBpdG0gKyAnXScpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICBtYXAuc2V0KHByZWZpeCArICdbJyArIGl0bSArICddJywganNvbltpdG1dKTtcclxuICAgICAgICB9XHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgcmV0dXJuIG1hcDtcclxuICAgIH1cclxuXHJcbiAgICBPYmplY3QuZW50cmllcyhqc29uKS5mb3JFYWNoKChba2V5LCB2YWx1ZV0pID0+IHtcclxuICAgICAgaWYgKElzRGF0YVR5cGVVdGlsLklzT2JqZWN0KGpzb25ba2V5XSkgJiYganNvbltrZXldKSB7XHJcbiAgICAgICAgdGhpcy5GbGF0dGVuTWFwKGpzb25ba2V5XSwgbWFwLCAocHJlZml4ID8gcHJlZml4ICsgJy4nIDogJycpICsga2V5KTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgIG1hcC5zZXQoKHByZWZpeCA/IHByZWZpeCArICcuJyA6ICcnKSArIGtleSwganNvbltrZXldKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcblxyXG4gICAgcmV0dXJuIG1hcDtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFVuZmxhdHRlbiBhbiBhbHJlYWR5IGZsYXR0ZW4gSlNPTiBvYmplY3RcclxuICAgKlxyXG4gICAqIEBwYXJhbSBtYXAgb2JqZWN0IHRvIHVuZmxhdHRlblxyXG4gICAqL1xyXG4gIHB1YmxpYyBzdGF0aWMgVW5mbGF0dGVuKG1hcDogb2JqZWN0KTogb2JqZWN0IHtcclxuICAgIGNvbnN0IHJldHVybk9iamVjdDogb2JqZWN0ID0ge307XHJcblxyXG4gICAgT2JqZWN0LmVudHJpZXMobWFwKS5mb3JFYWNoKChba2V5LCB2YWx1ZV0pID0+IHtcclxuICAgICAgY29uc3Qga2V5c1JlZ0V4OiBSZWdFeHAgPSAvKD86XFwuPyhbXi5bXSspKXwoXFxbXFxkK1xcXSkvZztcclxuICAgICAgbGV0IG1hdGNoOiBSZWdFeHBFeGVjQXJyYXkgfCBudWxsO1xyXG4gICAgICBsZXQgb2k6IG9iamVjdCA9IHJldHVybk9iamVjdDsgLy8gcmVmIHRvIHJldHVybk9iamVjdCwgbW9kaWZpZWQgaW4gbG9vcCBiZWxvd1xyXG5cclxuICAgICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOm5vLWNvbmRpdGlvbmFsLWFzc2lnbm1lbnRcclxuICAgICAgd2hpbGUgKG1hdGNoID0ga2V5c1JlZ0V4LmV4ZWMoa2V5KSkgeyAvLyBtZXRob2QgZXhlY3V0ZXMgYSBzZWFyY2ggZm9yIGEgbWF0Y2ggaW4gYSBzcGVjaWZpZWQgc3RyaW5nLiBSZXR1cm5zIGEgcmVzdWx0IGFycmF5LFxyXG4gICAgICAgIGNvbnN0IHByZWZpeDogc3RyaW5nID0ga2V5W21hdGNoLmluZGV4ICsgbWF0Y2hbMF0ubGVuZ3RoXTtcclxuICAgICAgICBsZXQga2V5TmFtZTogc3RyaW5nID0gbWF0Y2hbMV07XHJcblxyXG4gICAgICAgIGlmICghcHJlZml4KSB7IC8vIG5vdGhpbmcgbW9yZSwgc3RvcmUgdmFsdWUgaW4gb2lba2V5TmFtZV1cclxuICAgICAgICAgIG9pW2tleU5hbWVdID0gdmFsdWU7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICBpZiAoa2V5TmFtZSkge1xyXG4gICAgICAgICAgICBpZiAoIW9pLmhhc093blByb3BlcnR5KGtleU5hbWUpKSB7XHJcbiAgICAgICAgICAgICAgb2lba2V5TmFtZV0gPSBwcmVmaXggPT09ICdbJyA/IFtdIDoge307XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAga2V5TmFtZSA9IG1hdGNoWzJdLnNsaWNlKDEsIC0xKTtcclxuICAgICAgICAgIGlmICghb2kuaGFzT3duUHJvcGVydHkoa2V5TmFtZSkpIHtcclxuICAgICAgICAgICAgb2lba2V5TmFtZV0gPSBwcmVmaXggPT09ICdbJyA/IFtdIDoge307XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICAgICAgb2kgPSBvaVtrZXlOYW1lXTtcclxuICAgIH1cclxuICB9KTtcclxuICAgIHJldHVybiByZXR1cm5PYmplY3Q7XHJcbiB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBVbmZsYXR0ZW4gbWFwIGRhdGFcclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0gbWFwIG1hcCBkYXRhXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBzdGF0aWMgVW5mbGF0dGVuTWFwKG1hcDogYW55KTogb2JqZWN0IHtcclxuXHJcbiAgICAgIGNvbnN0IHJldHVybk9iamVjdDogb2JqZWN0ID0ge307XHJcblxyXG4gICAgICBtYXAuZm9yRWFjaCgodmFsdWU6IHN0cmluZywga2V5OiBzdHJpbmcpID0+IHtcclxuICAgICAgICAgIGNvbnN0IGtleXNSZWdFeDogUmVnRXhwID0gLyg/OlxcLj8oW14uW10rKSl8KFxcW1xcZCtcXF0pL2c7XHJcbiAgICAgICAgICBsZXQgbWF0Y2g6IFJlZ0V4cEV4ZWNBcnJheSB8IG51bGw7XHJcbiAgICAgICAgICBsZXQgb2k6IG9iamVjdCA9IHJldHVybk9iamVjdDsgLy8gcmVmIHRvIHJldHVybk9iamVjdCwgbW9kaWZpZWQgaW4gbG9vcCBiZWxvd1xyXG5cclxuICAgICAgICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTpuby1jb25kaXRpb25hbC1hc3NpZ25tZW50XHJcbiAgICAgICAgICB3aGlsZSAobWF0Y2ggPSBrZXlzUmVnRXguZXhlYyhrZXkpKSB7IC8vIG1ldGhvZCBleGVjdXRlcyBhIHNlYXJjaCBmb3IgYSBtYXRjaCBpbiBhIHNwZWNpZmllZCBzdHJpbmcuIFJldHVybnMgYSByZXN1bHQgYXJyYXksXHJcblxyXG4gICAgICAgICAgY29uc3QgcHJlZml4OiBzdHJpbmcgPSBrZXlbbWF0Y2guaW5kZXggKyBtYXRjaFswXS5sZW5ndGhdO1xyXG4gICAgICAgICAgbGV0IGtleU5hbWU6IHN0cmluZyA9IG1hdGNoWzFdO1xyXG5cclxuICAgICAgICAgIGlmICghcHJlZml4KSB7IC8vIG5vdGhpbmcgbW9yZSwgc3RvcmUgdmFsdWUgaW4gb2lba2V5TmFtZV1cclxuICAgICAgICAgICAgICBvaVtrZXlOYW1lXSA9IHZhbHVlO1xyXG4gICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICBpZiAoa2V5TmFtZSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKCFvaS5oYXNPd25Qcm9wZXJ0eShrZXlOYW1lKSkge1xyXG4gICAgICAgICAgICAgICAgICBvaVtrZXlOYW1lXSA9IHByZWZpeCA9PT0gJ1snID8gW10gOiB7fTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICBrZXlOYW1lID0gbWF0Y2hbMl0uc2xpY2UoMSwgLTEpO1xyXG4gICAgICAgICAgICAgIGlmICghb2kuaGFzT3duUHJvcGVydHkoa2V5TmFtZSkpIHtcclxuICAgICAgICAgICAgICAgIG9pW2tleU5hbWVdID0gcHJlZml4ID09PSAnWycgPyBbXSA6IHt9O1xyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgb2kgPSBvaVtrZXlOYW1lXTtcclxuICAgICAgICB9XHJcbiAgICAgIH0pO1xyXG4gICAgICByZXR1cm4gcmV0dXJuT2JqZWN0O1xyXG4gICAgfVxyXG4gfVxyXG4iXX0=