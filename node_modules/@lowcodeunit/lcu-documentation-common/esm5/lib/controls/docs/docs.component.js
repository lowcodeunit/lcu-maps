import { __assign, __decorate } from "tslib";
import { HttpClient } from '@angular/common/http';
import { Component, Input, Output, EventEmitter, HostListener } from '@angular/core';
import { isString } from 'util';
import { FlatTreeControl } from '@angular/cdk/tree';
import { MatTreeFlattener, MatTreeFlatDataSource } from '@angular/material/tree';
import { of as observableOf } from 'rxjs';
import { MarkedRenderer } from 'ngx-markdown';
var FileNode = /** @class */ (function () {
    function FileNode() {
    }
    return FileNode;
}());
export { FileNode };
/** Flat node with expandable and level information */
var FileFlatNode = /** @class */ (function () {
    function FileFlatNode(expandable, filename, level, path) {
        this.expandable = expandable;
        this.filename = filename;
        this.level = level;
        this.path = path;
    }
    return FileFlatNode;
}());
export { FileFlatNode };
export var originalHeading = new MarkedRenderer().heading;
export function markedOptionsFactory() {
    var renderer = new MarkedRenderer();
    var lastLevel = 0;
    renderer.heading = function (text, level, raw) {
        lastLevel = level;
        return '<h' + level + '>' + text + '</h' + level + '>\n';
    };
    renderer.link = function (href, title, text) {
        return "<a title=\"" + (title || '') + "\" href=\"" + href + "\">" + (text ||
            title ||
            href) + "</a>";
    };
    renderer.paragraph = function (text) {
        var pClass = '';
        switch (lastLevel) {
            case 1:
            case 2:
                pClass = 'mat-body-3';
                break;
            case 3:
            case 4:
                pClass = 'mat-body-2';
                break;
            default:
                pClass = 'mat-body-1';
                break;
        }
        return "<p class=\"" + pClass + "\">" + text + "</p>";
    };
    return { renderer: renderer };
}
var path = require('path-browserify');
var LcuDocsComponent = /** @class */ (function () {
    //  Constructors
    function LcuDocsComponent(http) {
        this.http = http;
        this.DocChange = new EventEmitter();
        this.TreeFlattener = new MatTreeFlattener(this.Transformer, this.getLevel, this.isExpandable, this.getChildren);
        this.TreeControl = new FlatTreeControl(this.getLevel, this.isExpandable);
        this.DataSource = new MatTreeFlatDataSource(this.TreeControl, this.TreeFlattener);
    }
    Object.defineProperty(LcuDocsComponent.prototype, "Docs", {
        set: function (docs) {
            var _this = this;
            this.http
                .get(path.join(docs, 'lcu.docs.json'))
                .subscribe(function (res) {
                _this.Config = res;
                _this.Reload();
            });
        },
        enumerable: true,
        configurable: true
    });
    //  Life Cycle
    LcuDocsComponent.prototype.ngOnInit = function () {
        this.Reload();
    };
    LcuDocsComponent.prototype.onClick = function (btn) {
        if (btn && btn.href && btn.href.endsWith('.md')) {
            var path_1 = btn.href.replace(document.getElementsByTagName('base')[0].href, '');
            console.log("Going to doc: " + path_1);
            this.GoToDoc(path_1);
            return false;
        }
    };
    //  API Methods
    LcuDocsComponent.prototype.BuildFileTree = function () {
        this.DataSource.data = this.buildFileTree(this.Config.Docs, 0);
    };
    LcuDocsComponent.prototype.FindDoc = function (path) {
        return this.Config.Docs.find(function (d) { return d.Path === path; });
    };
    LcuDocsComponent.prototype.GoToDoc = function (docOpt) {
        var docPath = isString(docOpt)
            ? docOpt
            : docOpt.Path;
        if (this.ActiveDocPath !== docPath) {
            this.ActiveDocPath = docPath;
        }
        this.calculateActiveDocData();
        this.DocChange.emit({ DocPath: docPath });
    };
    LcuDocsComponent.prototype.HasChild = function (_, nodeData) {
        return nodeData.expandable;
    };
    LcuDocsComponent.prototype.Reload = function () {
        if (this.Config && this.Config.Docs && this.Config.Docs.length > 0) {
            this.BuildFileTree();
            this.GoToDoc(this.ActiveDocPath || this.Config.DefaultDocPath || this.Config.Docs[0]);
        }
    };
    LcuDocsComponent.prototype.Transformer = function (node) {
        return new FileFlatNode(!!node.children, node.filename, node.level, node.path);
    };
    //  Helpers
    LcuDocsComponent.prototype.buildFileTree = function (docs, level) {
        var _this = this;
        return docs.reduce(function (accumulator, doc) {
            var node = _this.buildFileNodeFromDoc(doc, level);
            return accumulator.concat(node);
        }, []);
    };
    LcuDocsComponent.prototype.buildFileNodeFromDoc = function (doc, level, bypassChildren) {
        var node = new FileNode();
        if (doc != null) {
            node.filename = doc.Title;
            node.level = level;
            if (!bypassChildren && doc.Children && doc.Children.length > 0) {
                node.children = this.buildFileTree(doc.Children, level + 1);
                var docCatch = __assign({}, doc);
                docCatch.Children = null;
            }
            else {
                node.path = doc.Path;
            }
        }
        return node;
    };
    LcuDocsComponent.prototype.calculateActiveDocData = function () {
        if (this.Config && this.ActiveDocPath) {
            this.ActiveDocData = path.join(this.Config.LocationRoot, this.ActiveDocPath);
        }
        else {
            this.ActiveDocData = null;
        }
    };
    LcuDocsComponent.prototype.getLevel = function (node) {
        return node.level;
    };
    LcuDocsComponent.prototype.isExpandable = function (node) {
        return node.expandable;
    };
    LcuDocsComponent.prototype.getChildren = function (node) {
        return observableOf(node.children);
    };
    LcuDocsComponent.ctorParameters = function () { return [
        { type: HttpClient }
    ]; };
    __decorate([
        Input('config')
    ], LcuDocsComponent.prototype, "Config", void 0);
    __decorate([
        Input('docs')
    ], LcuDocsComponent.prototype, "Docs", null);
    __decorate([
        Output('docChange')
    ], LcuDocsComponent.prototype, "DocChange", void 0);
    __decorate([
        HostListener('click', ['$event.target'])
    ], LcuDocsComponent.prototype, "onClick", null);
    LcuDocsComponent = __decorate([
        Component({
            selector: 'lcu-markdown-docs',
            template: "<div fxLayout=\"row\" *ngIf=\"Config\">\r\n  <div fxFlex=\"0 1 auto\">\r\n    <mat-tree [dataSource]=\"DataSource\" [treeControl]=\"TreeControl\">\r\n      <mat-tree-node\r\n        *matTreeNodeDef=\"let node\"\r\n        matTreeNodeToggle\r\n        [matTreeNodePadding]=\"Config.IndentVariant * node.level\"\r\n      >\r\n        <button mat-icon-button disabled></button>\r\n\r\n        <a mat-button (click)=\"GoToDoc(node.path)\">{{ node.filename }}</a>\r\n      </mat-tree-node>\r\n\r\n      <mat-tree-node\r\n        *matTreeNodeDef=\"let node; when: HasChild\"\r\n        [matTreeNodePadding]=\"Config.IndentVariant * node.level\"\r\n      >\r\n        <button\r\n          mat-icon-button\r\n          matTreeNodeToggle\r\n          [attr.aria-label]=\"'toggle ' + node.filename\"\r\n        >\r\n          <mat-icon class=\"mat-icon-rtl-mirror\">\r\n            {{ TreeControl.isExpanded(node) ? \"expand_more\" : \"chevron_right\" }}\r\n          </mat-icon>\r\n        </button>\r\n\r\n        <a mat-button matTreeNodeToggle>{{ node.filename }}</a>\r\n      </mat-tree-node>\r\n    </mat-tree>\r\n  </div>\r\n\r\n  <div fxFlex=\"auto\">\r\n    <div class=\"push-right\">\r\n      <ng-container *ngIf=\"!!ActiveDocData\">\r\n        <markdown [src]=\"ActiveDocData\"></markdown>\r\n      </ng-container>\r\n    </div>\r\n  </div>\r\n</div>\r\n",
            styles: [":host .mat-tree{padding:1rem}"]
        })
    ], LcuDocsComponent);
    return LcuDocsComponent;
}());
export { LcuDocsComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZG9jcy5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AbG93Y29kZXVuaXQvbGN1LWRvY3VtZW50YXRpb24tY29tbW9uLyIsInNvdXJjZXMiOlsibGliL2NvbnRyb2xzL2RvY3MvZG9jcy5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxzQkFBc0IsQ0FBQztBQUNsRCxPQUFPLEVBQ0wsU0FBUyxFQUVULEtBQUssRUFDTCxNQUFNLEVBQ04sWUFBWSxFQUNaLFlBQVksRUFDYixNQUFNLGVBQWUsQ0FBQztBQU12QixPQUFPLEVBQUUsUUFBUSxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBQ2hDLE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQztBQUNwRCxPQUFPLEVBQUUsZ0JBQWdCLEVBQUUscUJBQXFCLEVBQUUsTUFBTSx3QkFBd0IsQ0FBQztBQUNqRixPQUFPLEVBQWMsRUFBRSxJQUFJLFlBQVksRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUN0RCxPQUFPLEVBQWlCLGNBQWMsRUFBRSxNQUFNLGNBQWMsQ0FBQztBQUU3RDtJQUFBO0lBS0EsQ0FBQztJQUFELGVBQUM7QUFBRCxDQUFDLEFBTEQsSUFLQzs7QUFFRCxzREFBc0Q7QUFDdEQ7SUFDRSxzQkFDUyxVQUFtQixFQUNuQixRQUFnQixFQUNoQixLQUFhLEVBQ2IsSUFBWTtRQUhaLGVBQVUsR0FBVixVQUFVLENBQVM7UUFDbkIsYUFBUSxHQUFSLFFBQVEsQ0FBUTtRQUNoQixVQUFLLEdBQUwsS0FBSyxDQUFRO1FBQ2IsU0FBSSxHQUFKLElBQUksQ0FBUTtJQUNsQixDQUFDO0lBQ04sbUJBQUM7QUFBRCxDQUFDLEFBUEQsSUFPQzs7QUFFRCxNQUFNLENBQUMsSUFBTSxlQUFlLEdBQUcsSUFBSSxjQUFjLEVBQUUsQ0FBQyxPQUFPLENBQUM7QUFFNUQsTUFBTSxVQUFVLG9CQUFvQjtJQUNsQyxJQUFNLFFBQVEsR0FBRyxJ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QztJQThCMUQ7UUFEQyxZQUFZLENBQUMsT0FBTyxFQUFFLENBQUMsZUFBZSxDQUFDLENBQUM7bURBV3hDO0lBOURVLGdCQUFnQjtRQUw1QixTQUFTLENBQUM7WUFDVCxRQUFRLEVBQUUsbUJBQW1CO1lBQzdCLHUxQ0FBb0M7O1NBRXJDLENBQUM7T0FDVyxnQkFBZ0IsQ0F1SjVCO0lBQUQsdUJBQUM7Q0FBQSxBQXZKRCxJQXVKQztTQXZKWSxnQkFBZ0IiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBIdHRwQ2xpZW50IH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uL2h0dHAnO1xyXG5pbXBvcnQge1xyXG4gIENvbXBvbmVudCxcclxuICBPbkluaXQsXHJcbiAgSW5wdXQsXHJcbiAgT3V0cHV0LFxyXG4gIEV2ZW50RW1pdHRlcixcclxuICBIb3N0TGlzdGVuZXJcclxufSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHtcclxuICBMY3VNYXJrZG93bkRvY3NDb25maWcsXHJcbiAgTGN1TWFya2Rvd25Eb2NDaGFuZ2VFdmVudCxcclxuICBMY3VNYXJrZG93bkRvY1xyXG59IGZyb20gJy4uLy4uL21vZGVscy9kb2NzLWNvbmZpZyc7XHJcbmltcG9ydCB7IGlzU3RyaW5nIH0gZnJvbSAndXRpbCc7XHJcbmltcG9ydCB7IEZsYXRUcmVlQ29udHJvbCB9IGZyb20gJ0Bhbmd1bGFyL2Nkay90cmVlJztcclxuaW1wb3J0IHsgTWF0VHJlZUZsYXR0ZW5lciwgTWF0VHJlZUZsYXREYXRhU291cmNlIH0gZnJvbSAnQGFuZ3VsYXIvbWF0ZXJpYWwvdHJlZSc7XHJcbmltcG9ydCB7IE9ic2VydmFibGUsIG9mIGFzIG9ic2VydmFibGVPZiB9IGZyb20gJ3J4anMnO1xyXG5pbXBvcnQgeyBNYXJrZWRPcHRpb25zLCBNYXJrZWRSZW5kZXJlciB9IGZyb20gJ25neC1tYXJrZG93bic7XHJcblxyXG5leHBvcnQgY2xhc3MgRmlsZU5vZGUge1xyXG4gIGNoaWxkcmVuOiBGaWxlTm9kZVtdO1xyXG4gIGZpbGVuYW1lOiBzdHJpbmc7XHJcbiAgbGV2ZWw6IG51bWJlcjtcclxuICBwYXRoOiBzdHJpbmc7XHJcbn1cclxuXHJcbi8qKiBGbGF0IG5vZGUgd2l0aCBleHBhbmRhYmxlIGFuZCBsZXZlbCBpbmZvcm1hdGlvbiAqL1xyXG5leHBvcnQgY2xhc3MgRmlsZUZsYXROb2RlIHtcclxuICBjb25zdHJ1Y3RvcihcclxuICAgIHB1YmxpYyBleHBhbmRhYmxlOiBib29sZWFuLFxyXG4gICAgcHVibGljIGZpbGVuYW1lOiBzdHJpbmcsXHJcbiAgICBwdWJsaWMgbGV2ZWw6IG51bWJlcixcclxuICAgIHB1YmxpYyBwYXRoOiBzdHJpbmdcclxuICApIHt9XHJcbn1cclxuXHJcbmV4cG9ydCBjb25zdCBvcmlnaW5hbEhlYWRpbmcgPSBuZXcgTWFya2VkUmVuZGVyZXIoKS5oZWFkaW5nO1xyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIG1hcmtlZE9wdGlvbnNGYWN0b3J5KCk6IE1hcmtlZE9wdGlvbnMge1xyXG4gIGNvbnN0IHJlbmRlcmVyID0gbmV3IE1hcmtlZFJlbmRlcmVyKCk7XHJcblxyXG4gIGxldCBsYXN0TGV2ZWwgPSAwO1xyXG5cclxuICByZW5kZXJlci5oZWFkaW5nID0gKHRleHQ6IHN0cmluZywgbGV2ZWw6IG51bWJlciwgcmF3OiBzdHJpbmcpID0+IHtcclxuICAgIGxhc3RMZXZlbCA9IGxldmVsO1xyXG4gICAgcmV0dXJuICc8aCcgKyBsZXZlbCArICc+JyArIHRleHQgKyAnPC9oJyArIGxldmVsICsgJz5cXG4nO1xyXG4gIH07XHJcblxyXG4gIHJlbmRlcmVyLmxpbmsgPSAoaHJlZjogc3RyaW5nLCB0aXRsZTogc3RyaW5nLCB0ZXh0OiBzdHJpbmcpID0+IHtcclxuICAgIHJldHVybiBgPGEgdGl0bGU9XCIke3RpdGxlIHx8ICcnfVwiIGhyZWY9XCIke2hyZWZ9XCI+JHt0ZXh0IHx8XHJcbiAgICAgIHRpdGxlIHx8XHJcbiAgICAgIGhyZWZ9PC9hPmA7XHJcbiAgfTtcclxuXHJcbiAgcmVuZGVyZXIucGFyYWdyYXBoID0gKHRleHQ6IHN0cmluZykgPT4ge1xyXG4gICAgbGV0IHBDbGFzcyA9ICcnO1xyXG5cclxuICAgIHN3aXRjaCAobGFzdExldmVsKSB7XHJcbiAgICAgIGNhc2UgMTpcclxuICAgICAgY2FzZSAyOlxyXG4gICAgICAgIHBDbGFzcyA9ICdtYXQtYm9keS0zJztcclxuICAgICAgICBicmVhaztcclxuICAgICAgY2FzZSAzOlxyXG4gICAgICBjYXNlIDQ6XHJcbiAgICAgICAgcENsYXNzID0gJ21hdC1ib2R5LTInO1xyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgICBkZWZhdWx0OlxyXG4gICAgICAgIHBDbGFzcyA9ICdtYXQtYm9keS0xJztcclxuICAgICAgICBicmVhaztcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gYDxwIGNsYXNzPVwiJHtwQ2xhc3N9XCI+JHt0ZXh0fTwvcD5gO1xyXG4gIH07XHJcblxyXG4gIHJldHVybiB7IHJlbmRlcmVyIH07XHJcbn1cclxuXHJcbmNvbnN0IHBhdGggPSByZXF1aXJlKCdwYXRoLWJyb3dzZXJpZnknKTtcclxuXHJcbkBDb21wb25lbnQoe1xyXG4gIHNlbGVjdG9yOiAnbGN1LW1hcmtkb3duLWRvY3MnLFxyXG4gIHRlbXBsYXRlVXJsOiAnLi9kb2NzLmNvbXBvbmVudC5odG1sJyxcclxuICBzdHlsZVVybHM6IFsnLi9kb2NzLmNvbXBvbmVudC5zY3NzJ11cclxufSlcclxuZXhwb3J0IGNsYXNzIExjdURvY3NDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQge1xyXG5cclxuICAvLyAgUHJvcGVydGllc1xyXG4gIHB1YmxpYyBBY3RpdmVEb2NEYXRhOiBzdHJpbmc7XHJcbiAgcHVibGljIEFjdGl2ZURvY1BhdGg6IHN0cmluZztcclxuICBwdWJsaWMgRGF0YVNvdXJjZTogTWF0VHJlZUZsYXREYXRhU291cmNlPEZpbGVOb2RlLCBGaWxlRmxhdE5vZGU+O1xyXG4gIHB1YmxpYyBUcmVlQ29udHJvbDogRmxhdFRyZWVDb250cm9sPEZpbGVGbGF0Tm9kZT47XHJcbiAgcHVibGljIFRyZWVGbGF0dGVuZXI6IE1hdFRyZWVGbGF0dGVuZXI8RmlsZU5vZGUsIEZpbGVGbGF0Tm9kZT47XHJcblxyXG4gIEBJbnB1dCgnY29uZmlnJykgcHVibGljIENvbmZpZzogTGN1TWFya2Rvd25Eb2NzQ29uZmlnO1xyXG5cclxuICBASW5wdXQoJ2RvY3MnKVxyXG4gIHB1YmxpYyBzZXQgRG9jcyhkb2NzOiBzdHJpbmcpIHtcclxuICAgIHRoaXMuaHR0cFxyXG4gICAgICAuZ2V0KHBhdGguam9pbihkb2NzLCAnbGN1LmRvY3MuanNvbicpKVxyXG4gICAgICAuc3Vic2NyaWJlKChyZXM6IExjdU1hcmtkb3duRG9jc0NvbmZpZykgPT4ge1xyXG4gICAgICAgIHRoaXMuQ29uZmlnID0gcmVzO1xyXG4gICAgICAgIHRoaXMuUmVsb2FkKCk7XHJcbiAgICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgQE91dHB1dCgnZG9jQ2hhbmdlJylcclxuICBwdWJsaWMgRG9jQ2hhbmdlOiBFdmVudEVtaXR0ZXI8TGN1TWFya2Rvd25Eb2NDaGFuZ2VFdmVudD47XHJcblxyXG4gIC8vICBDb25zdHJ1Y3RvcnNcclxuICBjb25zdHJ1Y3Rvcihwcm90ZWN0ZWQgaHR0cDogSHR0cENsaWVudCkge1xyXG4gICAgdGhpcy5Eb2NDaGFuZ2UgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XHJcblxyXG4gICAgdGhpcy5UcmVlRmxhdHRlbmVyID0gbmV3IE1hdFRyZWVGbGF0dGVuZXIoXHJcbiAgICAgIHRoaXMuVHJhbnNmb3JtZXIsXHJcbiAgICAgIHRoaXMuZ2V0TGV2ZWwsXHJcbiAgICAgIHRoaXMuaXNFeHBhbmRhYmxlLFxyXG4gICAgICB0aGlzLmdldENoaWxkcmVuXHJcbiAgICApO1xyXG5cclxuICAgIHRoaXMuVHJlZUNvbnRyb2wgPSBuZXcgRmxhdFRyZWVDb250cm9sPEZpbGVGbGF0Tm9kZT4oXHJcbiAgICAgIHRoaXMuZ2V0TGV2ZWwsXHJcbiAgICAgIHRoaXMuaXNFeHBhbmRhYmxlXHJcbiAgICApO1xyXG5cclxuICAgIHRoaXMuRGF0YVNvdXJjZSA9IG5ldyBNYXRUcmVlRmxhdERhdGFTb3VyY2UoXHJcbiAgICAgIHRoaXMuVHJlZUNvbnRyb2wsXHJcbiAgICAgIHRoaXMuVHJlZUZsYXR0ZW5lclxyXG4gICAgKTtcclxuICB9XHJcblxyXG4gIC8vICBMaWZlIEN5Y2xlXHJcbiAgcHVibGljIG5nT25Jbml0KCk6IHZvaWQge1xyXG4gICAgdGhpcy5SZWxvYWQoKTtcclxuICB9XHJcblxyXG4gIEBIb3N0TGlzdGVuZXIoJ2NsaWNrJywgWyckZXZlbnQudGFyZ2V0J10pXHJcbiAgcHVibGljIG9uQ2xpY2soYnRuOiBhbnkpIHtcclxuICAgIGlmIChidG4gJiYgYnRuLmhyZWYgJiYgKGJ0bi5ocmVmIGFzIHN0cmluZykuZW5kc1dpdGgoJy5tZCcpKSB7XHJcbiAgICAgIGNvbnN0IHBhdGggPSBidG4uaHJlZi5yZXBsYWNlKGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCdiYXNlJylbMF0uaHJlZiwgJycpO1xyXG5cclxuICAgICAgY29uc29sZS5sb2coYEdvaW5nIHRvIGRvYzogJHtwYXRofWApO1xyXG5cclxuICAgICAgdGhpcy5Hb1RvRG9jKHBhdGgpO1xyXG5cclxuICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLy8gIEFQSSBNZXRob2RzXHJcbiAgcHVibGljIEJ1aWxkRmlsZVRyZWUoKTogdm9pZCB7XHJcbiAgICB0aGlzLkRhdGFTb3VyY2UuZGF0YSA9IHRoaXMuYnVpbGRGaWxlVHJlZSh0aGlzLkNvbmZpZy5Eb2NzLCAwKTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBGaW5kRG9jKHBhdGg6IHN0cmluZyk6IExjdU1hcmtkb3duRG9jIHtcclxuICAgIHJldHVybiB0aGlzLkNvbmZpZy5Eb2NzLmZpbmQoZCA9PiBkLlBhdGggPT09IHBhdGgpO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIEdvVG9Eb2MoZG9jT3B0OiBMY3VNYXJrZG93bkRvYyB8IHN0cmluZyk6IHZvaWQge1xyXG4gICAgY29uc3QgZG9jUGF0aCA9IGlzU3RyaW5nKGRvY09wdClcclxuICAgICAgPyBkb2NPcHQgYXMgc3RyaW5nXHJcbiAgICAgIDogKGRvY09wdCBhcyBMY3VNYXJrZG93bkRvYykuUGF0aDtcclxuXHJcbiAgICBpZiAodGhpcy5BY3RpdmVEb2NQYXRoICE9PSBkb2NQYXRoKSB7XHJcbiAgICAgIHRoaXMuQWN0aXZlRG9jUGF0aCA9IGRvY1BhdGg7XHJcbiAgICB9XHJcblxyXG4gICAgdGhpcy5jYWxjdWxhdGVBY3RpdmVEb2NEYXRhKCk7XHJcbiAgICB0aGlzLkRvY0NoYW5nZS5lbWl0KHsgRG9jUGF0aDogZG9jUGF0aCB9KTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBIYXNDaGlsZChfOiBudW1iZXIsIG5vZGVEYXRhOiBGaWxlRmxhdE5vZGUpOiBib29sZWFuIHtcclxuICAgIHJldHVybiBub2RlRGF0YS5leHBhbmRhYmxlO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIFJlbG9hZCgpOiB2b2lkIHtcclxuICAgIGlmICh0aGlzLkNvbmZpZyAmJiB0aGlzLkNvbmZpZy5Eb2NzICYmIHRoaXMuQ29uZmlnLkRvY3MubGVuZ3RoID4gMCkge1xyXG4gICAgICB0aGlzLkJ1aWxkRmlsZVRyZWUoKTtcclxuXHJcbiAgICAgIHRoaXMuR29Ub0RvYyhcclxuICAgICAgICB0aGlzLkFjdGl2ZURvY1BhdGggfHwgdGhpcy5Db25maWcuRGVmYXVsdERvY1BhdGggfHwgdGhpcy5Db25maWcuRG9jc1swXVxyXG4gICAgICApO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcHVibGljIFRyYW5zZm9ybWVyKG5vZGU6IEZpbGVOb2RlKTogRmlsZUZsYXROb2RlIHtcclxuICAgIHJldHVybiBuZXcgRmlsZUZsYXROb2RlKCEhbm9kZS5jaGlsZHJlbiwgbm9kZS5maWxlbmFtZSwgbm9kZS5sZXZlbCwgbm9kZS5wYXRoKTtcclxuICB9XHJcblxyXG4gIC8vICBIZWxwZXJzXHJcbiAgcHJvdGVjdGVkIGJ1aWxkRmlsZVRyZWUoZG9jczogTGN1TWFya2Rvd25Eb2NbXSwgbGV2ZWw6IG51bWJlcik6IEZpbGVOb2RlW10ge1xyXG4gICAgcmV0dXJuIGRvY3MucmVkdWNlPEZpbGVOb2RlW10+KChhY2N1bXVsYXRvciwgZG9jKSA9PiB7XHJcbiAgICAgIGNvbnN0IG5vZGUgPSB0aGlzLmJ1aWxkRmlsZU5vZGVGcm9tRG9jKGRvYywgbGV2ZWwpO1xyXG5cclxuICAgICAgcmV0dXJuIGFjY3VtdWxhdG9yLmNvbmNhdChub2RlKTtcclxuICAgIH0sIFtdKTtcclxuICB9XHJcblxyXG4gIHByb3RlY3RlZCBidWlsZEZpbGVOb2RlRnJvbURvYyhkb2M6IExjdU1hcmtkb3duRG9jLCBsZXZlbDogbnVtYmVyLCBieXBhc3NDaGlsZHJlbj86IGJvb2xlYW4pOiBGaWxlTm9kZSB7XHJcbiAgICBjb25zdCBub2RlID0gbmV3IEZpbGVOb2RlKCk7XHJcblxyXG4gICAgaWYgKGRvYyAhPSBudWxsKSB7XHJcbiAgICAgIG5vZGUuZmlsZW5hbWUgPSBkb2MuVGl0bGU7XHJcbiAgICAgIG5vZGUubGV2ZWwgPSBsZXZlbDtcclxuXHJcbiAgICAgIGlmICghYnlwYXNzQ2hpbGRyZW4gJiYgZG9jLkNoaWxkcmVuICYmIGRvYy5DaGlsZHJlbi5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgbm9kZS5jaGlsZHJlbiA9IHRoaXMuYnVpbGRGaWxlVHJlZShkb2MuQ2hpbGRyZW4sIGxldmVsICsgMSk7XHJcbiAgICAgICAgY29uc3QgZG9jQ2F0Y2ggPSB7Li4uZG9jfTtcclxuICAgICAgICBkb2NDYXRjaC5DaGlsZHJlbiA9IG51bGw7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgbm9kZS5wYXRoID0gZG9jLlBhdGg7XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gbm9kZTtcclxuICB9XHJcblxyXG4gIHByb3RlY3RlZCBjYWxjdWxhdGVBY3RpdmVEb2NEYXRhKCk6IHZvaWQge1xyXG4gICAgaWYgKHRoaXMuQ29uZmlnICYmIHRoaXMuQWN0aXZlRG9jUGF0aCkge1xyXG4gICAgICB0aGlzLkFjdGl2ZURvY0RhdGEgPSBwYXRoLmpvaW4odGhpcy5Db25maWcuTG9jYXRpb25Sb290LCB0aGlzLkFjdGl2ZURvY1BhdGgpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdGhpcy5BY3RpdmVEb2NEYXRhID0gbnVsbDtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHByb3RlY3RlZCBnZXRMZXZlbChub2RlOiBGaWxlRmxhdE5vZGUpOiBudW1iZXIge1xyXG4gICAgcmV0dXJuIG5vZGUubGV2ZWw7XHJcbiAgfVxyXG5cclxuICBwcm90ZWN0ZWQgaXNFeHBhbmRhYmxlKG5vZGU6IEZpbGVGbGF0Tm9kZSk6IGJvb2xlYW4ge1xyXG4gICAgcmV0dXJuIG5vZGUuZXhwYW5kYWJsZTtcclxuICB9XHJcblxyXG4gIHByb3RlY3RlZCBnZXRDaGlsZHJlbihub2RlOiBGaWxlTm9kZSk6IE9ic2VydmFibGU8RmlsZU5vZGVbXT4ge1xyXG4gICAgcmV0dXJuIG9ic2VydmFibGVPZihub2RlLmNoaWxkcmVuKTtcclxuICB9XHJcbn1cclxuIl19